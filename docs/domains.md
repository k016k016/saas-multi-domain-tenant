# domains.md
各ドメイン (www / app / admin / ops) は責務が異なる。統合・混在はしないこと。

---

## www ドメイン
目的:
- 公開向けサイト (LP、サービス紹介、導線)
- サインアップ / ログイン導線（将来実装予定）

禁止:
- 認証済みの業務データや組織内部の情報を表示しない
- ダッシュボード、日常業務UIを置かない
- 組織やユーザー管理系の画面を置かない

まとめ:
- ここは営業面・案内面だけ。アプリ内部ロジックは持たない

---

## app ドメイン
目的:
- 日常業務用のUI
- `member` / `admin` / `owner` が共通で使う領域
- 自分の業務データ・日々のタスク・進捗・プロフィール・通知など
- 現在の所属組織(org_id)のコンテキストで動く
- 組織切替UI（/switch-org など）もここに置く

できることの例:
- 自分に紐づくデータの閲覧・登録・更新
- 現在アクティブなorgの表示
- orgの切り替え要求（Server Actionにリクエストし、nextUrlを受けて遷移する）

禁止:
- 組織そのものを壊す/変える操作は持たないこと
  - 支払い情報の変更
  - 組織の凍結・廃止
  - owner権限の譲渡
  - admin権限の強制付け替え
- 組織内の他ユーザー管理UI（招待・無効化・ロール変更）をここに置かないこと
- 「全ユーザー/全組織の一覧」「監査ログの全履歴」などの管理者視点UIを置かないこと

要点:
- app は現場オペレーション用。破壊系・契約系の権限操作は入れない

---

## admin ドメイン
目的:
- 組織の運用・契約・リスク管理のためのUI
- `admin` / `owner` のみがアクセスできる。`member` は403で弾く

adminができること:
- 同一組織内ユーザーのCRUD
  - 招待 / 更新 / 無効化
  - member/adminロールの切り替え
- 組織サマリの閲覧（契約プラン、ステータスなど）

ownerだけができること（adminは不可）:
- 組織の支払い情報の変更
- 組織の凍結 / 廃止（状態遷移として扱う）
- admin権限の付け替え
- owner権限の譲渡（新オーナーを指名し、自分は降格する）
- これらはすべて監査ログ(activity_logs)に必ず記録される前提

重要:
- 上記の「owner専用」操作は app 側に置かない。必ず admin 側に置く
- admin ドメインには高リスク操作や契約・請求絡みのUIが集約される

---

## ops ドメイン
目的:
- SaaS提供側（ベンダー側）の内部コンソール
- 運用/サポート/監査向け

現時点:
- この雛形ではダミーページのみを置く
- 複数組織を横断して監査・サポートするイメージではあるが、**現段階では実装しない**
- 特に、RLSをバイパスして全テナント横断のデータにアクセスするような仕組みはこの雛形では入れない

---

## ドメイン分離のルール
- www / app / admin / ops は役割が違う
- 「全部 app にまとめたほうが簡単では？」のような統合提案は禁止
- 「member も admin 画面を閲覧できるように一時的に開放する」は禁止
- 支払い・凍結・owner譲渡といった組織レベルの生殺与奪系操作は admin のみ（かつ owner専用）で扱い、appに出さない

---

## 参考
詳細な禁止事項・境界条件（ロール階層、RLS、Server Actionでredirect禁止、ブランチ運用など）は
`CLAUDE_RUNTIME_MIN.md` と `CLAUDE_RUNTIME_FULL.md` を参照すること。
これらより緩い運用や統合提案は受け入れない。