# 2025-10-29 作業ログ

## ポート番号変更 (3001/3002/3003/3004)

### 目的
各アプリのポート番号を1つずつシフトして、ポート3000を別用途に開放する。

### 変更内容

#### 1. ファイル名修正
- `CLAUDE_RUNTIME_FULLmd` → `CLAUDE_RUNTIME_FULL.md` (拡張子追加)

#### 2. package.json のポート番号更新 (4ファイル)

**apps/www/package.json**
- 変更前: `"dev": "next dev -p 3000"`, `"start": "next start -p 3000"`
- 変更後: `"dev": "next dev -p 3001"`, `"start": "next start -p 3001"`

**apps/app/package.json**
- 変更前: `"dev": "next dev -p 3001"`, `"start": "next start -p 3001"`
- 変更後: `"dev": "next dev -p 3002"`, `"start": "next start -p 3002"`

**apps/admin/package.json**
- 変更前: `"dev": "next dev -p 3002"`, `"start": "next start -p 3002"`
- 変更後: `"dev": "next dev -p 3003"`, `"start": "next start -p 3003"`

**apps/ops/package.json**
- 変更前: `"dev": "next dev -p 3003"`, `"start": "next start -p 3003"`
- 変更後: `"dev": "next dev -p 3004"`, `"start": "next start -p 3004"`

#### 3. CLAUDE_RUNTIME_FULL.md のドキュメント更新

**セクション8「ローカル開発時の起動方法」**
- コマンド例のポート番号コメントを更新
  - www: 3000 → 3001
  - app: 3001 → 3002
  - admin: 3002 → 3003
  - ops: 3003 → 3004

**アクセスURL**
- `http://www.local.test:3000` → `http://www.local.test:3001`
- `http://app.local.test:3001` → `http://app.local.test:3002`
- `http://admin.local.test:3002` → `http://admin.local.test:3003`
- `http://ops.local.test:3003` → `http://ops.local.test:3004`

**Cookie共有の説明**
- 例示ポート番号を更新: `app.local.test:3001` や `admin.local.test:3002` → `app.local.test:3002` や `admin.local.test:3003`

### 新しいポート構成

| ドメイン | 旧ポート | 新ポート | 役割 |
|---------|---------|---------|------|
| www     | 3000    | **3001** | 外向けLP・ログイン導線 |
| app     | 3001    | **3002** | 日常業務UI |
| admin   | 3002    | **3003** | 組織管理・高リスク操作 |
| ops     | 3003    | **3004** | 事業者側内部コンソール |

### 起動コマンド

```bash
# 各ターミナルで実行
cd apps/www && pnpm run dev    # ポート 3001
cd apps/app && pnpm run dev    # ポート 3002
cd apps/admin && pnpm run dev  # ポート 3003
cd apps/ops && pnpm run dev    # ポート 3004
```

### 注意事項
- `/etc/hosts` の設定は変更不要（ドメイン名はそのまま）
- Cookie共有の仕組みは変更なし（ポート番号はCookieスコープに影響しない）
- 4-App独立アーキテクチャは維持

### 関連ファイル
- `CLAUDE_RUNTIME_FULL.md`: L214-223, L237-240, L255
- `apps/www/package.json`: L6, L8
- `apps/app/package.json`: L6, L8
- `apps/admin/package.json`: L6, L8
- `apps/ops/package.json`: L6, L8
