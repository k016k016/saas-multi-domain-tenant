1. 目的（最小コスト運用）
	•	デバッグはまずデータを疑う。コード調整は最後。
	•	回答は短く、断定的に。重複禁止、推測の羅列禁止。

2. ゴールデンルール
	•	Cookie共有 ≠ 入場許可。入場可否は各アプリのミドルウェアが決める。
	•	管理ドメインは admin/owner のみ許可。member は 403（リダイレクトで誤魔化さない）。
	•	ホストは役割ごとに分離（www / app / admin）。devの便利リライトに依存しない。

3. Data-First Preflight（必須・未確認なら作業中止）

以下5点が “確認済み” にならない限り、待機条件変更・コード修正・テスト改変を提案しない。
	1.	環境変数の存在：必須キーが全て設定済みであること（値は開示しない）。
	2.	パスワード認証の成立：対象ユーザーで正常にログインできる事実。
	3.	membership とロール一致：対象組織でのロールがテスト前提と一致。
	4.	org_id クッキー属性：サブドメイン共有に必要な属性になっていること。
	5.	管理ミドルウェア適用：管理ドメインのリクエストがミドルウェアに到達している事実。

いずれか未確認／不一致 ⇒ まずデータを修正してから再評価。
すべてOK ⇒ 初めてコード／ビルド／待機条件を検討。

4. コード側に進む条件と順序（最短）
	1.	ルーティング前提：各ホストで正しく配信されているか（baseURL/hosts/ matcherの整合）。
	2.	ミドルウェア：判定は組織membershipのみで行い、フォールバック（profiles等）は禁止。
	3.	ビルド差：prodとdevの差異（トランスパイル対象、キャッシュ、matcher生成）を排除。
	4.	E2E待機：networkidleを使わない。**URLの確定＋UIシグナル（安定locator）**で終える。

5. 回答フォーマット（固定）
	•	DATA-CHECKS：上記5項目を「OK／未確認／不一致」で箇条書き（根拠は短文）。
	•	ROOT-CAUSE：原因を1つに絞って断定。
	•	FIX：直す順を番号で短く（最大3手）。冗長・代替案乱発は禁止。

6. 禁止事項（節約のための縛り）
	•	未検証のまま待機時間延長・networkidle採用・リダイレクト回避策を提案しない。
	•	ログやトレースの長文貼付、スタックトレースの丸写し、秘密値の開示は禁止。
	•	同一趣旨の表現を言い換えて二度書かない。過去の前提の再説明もしない。

7. テスト設計の最小原則
	•	ドメイン分離：プロジェクト単位で baseURL を分け、相対パスで叩く。
	•	合格条件：期待URL＋“準備完了”locatorのみ。スナップショット乱用禁止。
	•	権限系：管理は403を検証。/unauthorized 前提のテストは廃止。
	•	E2Eテストをする前に、サーバーを停止し、データをリセットすること。

8. 既知の落とし穴（先に疑う）
	•	dev専用のリライトに依存／prodでmatcher不一致
	•	org_id の属性不備（共有されていないのに前提として扱う）
	•	membershipのseed差分やプロジェクト取り違え
	•	トランスパイル漏れやキャッシュ残留によるprod専用バグ

9. 変更ポリシー
	•	追加のルールはMINに先に反映。FULLは詳細・補遺のみ。
	•	MINの文量は必要最小限を維持。各項目は1～3行で収める。
